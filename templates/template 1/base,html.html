{% load static %}
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %} {% endblock %}</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts - Roboto -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
	<link href="{% static style.css %]" rel="stylesheet">
    
 
</head>
<body>

<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark gradient-bg">
    <div class="container">
        <a class="navbar-brand" href="/">
            <div class="logo">
                <i class="fas fa-calendar-check fa-lg"></i>
            </div>
            ServiceBooking Pro
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="#" id="servicesLink"><i class="fas fa-concierge-bell me-1"></i> Services</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="dashboardLink"><i class="fas fa-chart-line me-1"></i> Dashboard</a>
                </li>
            </ul>
            
            <form class="d-flex search-form me-3">
                <input class="form-control me-2" type="search" placeholder="Service suchen..." aria-label="Search">
                <button class="btn search-btn" type="submit"><i class="fas fa-search"></i></button>
            </form>
            
            <ul class="navbar-nav" id="authLinks">
                <li class="nav-item">
                    <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">
                        <i class="fas fa-sign-in-alt me-1"></i> Login
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#registerModal">
                        <i class="fas fa-user-plus me-1"></i> Register
                    </a>
                </li>
            </ul>
            <div class="navbar-nav" id="userMenu" style="display: none;">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <div class="user-avatar" id="userAvatar">JD</div>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" id="userProfileLink"><i class="fas fa-user me-2"></i>My Profile</a></li>
                        <li><a class="dropdown-item" href="#" id="userBookingsLink"><i class="fas fa-calendar me-2"></i>My Bookings</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" id="logoutLink"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                    </ul>
                </li>
            </div>
        </div>
    </div>
</nav>

<!-- Main Content -->
<div class="container py-5 main-content" id="mainContent">
    <!-- Services Section -->
    <div id="servicesSection">
        <div class="row mb-4">
            <div class="col">
                <h1 class="fw-bold gradient-text">Available Services</h1>
                <p class="text-muted">Choose from our wide range of services</p>
            </div>
        </div>

        <!-- Services Table -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Service Name</th>
                                <!--<th>Description</th>-->
                                <th>Category</th>
                                <th>Price per Day</th>
                                <th class="text-end">Action</th>
                            </tr>
                        </thead>
                        <tbody>
						{% for s in services %}
                            <tr>
                                <td><div class="service-icon"><i class="fas fa-building"></i></div></td>
                                <td><a href="{% url 'service_detail' s.pk %}">{{ s.name }}</a></td>
                                <td class="description-column">Spacious room with capacity for 20 people, perfect for meetings</td>
                                <td><span class="service-category">{{ s.category }}</span></td>
                                <td>{{ s.price }} â‚¬</td>
                                <td class="text-end">
                                    <button class="btn btn-primary btn-sm book-now-btn" data-service-id="1" data-service-name="Conference Room A" data-service-price="120">
                                        <i class="fas fa-bookmark me-1"></i> Book Now
                                    </button>
                                </td>
                            </tr>
                          {% empty %}<li>Keine Services.</li>{% endfor %}
						 
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <nav aria-label="Service pagination">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                        </li>
                        <li class="page-item active" aria-current="page">
                            <a class="page-link" href="#">1</a>
                        </li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap & jQuery JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Simulated backend data
    const users = [];
    let bookings = [
        { id: 1, service: "Conference Room A", date: "2023-06-10", period: "3 days", amount: 396.00, status: "Completed" },
        { id: 2, service: "Audio Visual Equipment", date: "2023-06-15", period: "2 days", amount: 187.00, status: "Completed" },
        { id: 3, service: "IT Support Technician", date: "2023-06-25", period: "1 day", amount: 165.00, status: "Upcoming" }
    ];
    
    let currentUser = null;
    let selectedService = null;
    let bookingData = {};

    $(document).ready(function() {
        // Check if user is logged in (from localStorage)
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            updateUIAfterLogin();
        }

        // Payment method selection
        $('.payment-option').click(function() {
            $('.payment-option').removeClass('selected');
            $(this).addClass('selected');
            $('.form-check-input', this).prop('checked', true);
            
            if ($(this).data('method') === 'credit-card') {
                $('#credit-card-form').removeClass('d-none');
                $('#paypal-form').addClass('d-none');
            } else {
                $('#credit-card-form').addClass('d-none');
                $('#paypal-form').removeClass('d-none');
            }
        });
        
        // Book Now button click
        $('.book-now-btn').click(function() {
            if (!currentUser) {
                $('#loginModal').modal('show');
                return;
            }
            
            const serviceId = $(this).data('service-id');
            const serviceName = $(this).data('service-name');
            const servicePrice = $(this).data('service-price');
            
            selectedService = {
                id: serviceId,
                name: serviceName,
                price: servicePrice
            };
            
            $('#bookingServiceName').text(serviceName);
            $('#bookingServicePrice').html(`<span class="text-primary">$${servicePrice} per day</span>`);
            $('#summaryPricePerDay').text(`$${servicePrice}.00`);
            
            // Set default dates (today and tomorrow)
            const today = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(today.getDate() + 1);
            
            $('#startDate').val(formatDate(today));
            $('#endDate').val(formatDate(tomorrow));
            
            calculateBookingSummary();
            
            $('#bookingModal').modal('show');
        });
        
        // Date change handlers
        $('#startDate, #endDate').change(function() {
            calculateBookingSummary();
        });
        
        // Login form submission
        $('#loginForm').submit(function(e) {
            e.preventDefault();
            const email = $('#loginEmail').val();
            const password = $('#loginPassword').val();
            
            // Simulate authentication
            const user = users.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                updateUIAfterLogin();
                $('#loginModal').modal('hide');
                $('#loginForm')[0].reset();
            } else {
                alert('Invalid email or password. Please try again.');
            }
        });
        
        // Register form submission
        $('#registerForm').submit(function(e) {
            e.preventDefault();
            const firstName = $('#firstName').val();
            const lastName = $('#lastName').val();
            const email = $('#registerEmail').val();
            const password = $('#registerPassword').val();
            const confirmPassword = $('#confirmPassword').val();
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            // Check if user already exists
            if (users.find(u => u.email === email)) {
                alert('User with this email already exists');
                return;
            }
            
            // Create new user
            const newUser = {
                id: users.length + 1,
                firstName,
                lastName,
                email,
                password
            };
            
            users.push(newUser);
            currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(newUser));
            
            updateUIAfterLogin();
            $('#registerModal').modal('hide');
            $('#registerForm')[0].reset();
            
            alert('Registration successful! You are now logged in.');
        });
        
        // Logout handler
        $('#logoutLink').click(function() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            $('#authLinks').show();
            $('#userMenu').hide();
            $('#servicesSection').show();
            $('#dashboardSection').hide();
        });
        
        // Navigation handlers
        $('#dashboardLink').click(function(e) {
            e.preventDefault();
            if (!currentUser) {
                $('#loginModal').modal('show');
                return;
            }
            $('#servicesSection').hide();
            $('#dashboardSection').show();
        });
        
        $('#servicesLink').click(function(e) {
            e.preventDefault();
            $('#servicesSection').show();
            $('#dashboardSection').hide();
        });
        
        // Proceed to payment button
        $('#proceedToPaymentBtn').click(function() {
            $('#paymentServiceName').text(selectedService.name);
            $('#paymentServicePrice').text('$' + bookingData.subtotal.toFixed(2));
            $('#paymentTax').text('$' + bookingData.tax.toFixed(2));
            $('#paymentTotal').text('$' + bookingData.total.toFixed(2));
            
            $('#bookingModal').modal('hide');
            $('#paymentModal').modal('show');
        });
        
        // Pay now button
        $('#payNowBtn').click(function() {
            // Create a new booking
            const newBooking = {
                id: bookings.length + 1,
                service: selectedService.name,
                date: new Date().toISOString().split('T')[0],
                period: bookingData.days + ' days',
                amount: bookingData.total,
                status: 'Upcoming'
            };
            
            bookings.push(newBooking);
            
            // Update dashboard stats
            updateDashboardStats();
            
            // Generate random booking ID
            const bookingId = 'BK' + Math.floor(100000000 + Math.random() * 900000000);
            $('#bookingId').text(bookingId);
            
            $('#paymentModal').modal('hide');
            $('#successModal').modal('show');
        });
        
        // Success modal close
        $('#successModal').on('hidden.bs.modal', function() {
            // Refresh bookings table
            updateBookingsTable();
        });
    });
    
    function calculateBookingSummary() {
        const startDate = new Date($('#startDate').val());
        const endDate = new Date($('#endDate').val());
        
        if (startDate && endDate && startDate < endDate) {
            const days = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            const pricePerDay = selectedService.price;
            const subtotal = days * pricePerDay;
            const tax = subtotal * 0.1;
            const total = subtotal + tax;
            
            $('#summaryPeriod').text(`${days} days (${formatDate(startDate)} - ${formatDate(endDate)})`);
            $('#summarySubtotal').text('$' + subtotal.toFixed(2));
            $('#summaryTax').text('$' + tax.toFixed(2));
            $('#summaryTotal').text('$' + total.toFixed(2));
            
            // Enable proceed button
            $('#proceedToPaymentBtn').prop('disabled', false);
            
            // Store booking data
            bookingData = {
                days,
                subtotal,
                tax,
                total
            };
        } else {
            $('#summaryPeriod').text('-');
            $('#summarySubtotal').text('$0.00');
            $('#summaryTax').text('$0.00');
            $('#summaryTotal').text('$0.00');
            
            // Disable proceed button
            $('#proceedToPaymentBtn').prop('disabled', true);
        }
    }
    
    function formatDate(date) {
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }
    
    function updateUIAfterLogin() {
        $('#authLinks').hide();
        $('#userMenu').show();
        $('#userAvatar').text(currentUser.firstName[0] + currentUser.lastName[0]);
        updateDashboardStats();
        updateBookingsTable();
    }
    
    function updateDashboardStats() {
        const totalBookings = bookings.length;
        const totalSpent = bookings.reduce((sum, booking) => sum + booking.amount, 0);
        const upcomingBookings = bookings.filter(booking => booking.status === 'Upcoming').length;
        
        $('#totalBookings').text(totalBookings);
        $('#totalSpent').text('$' + totalSpent.toFixed(2));
        $('#upcomingBookings').text(upcomingBookings);
    }
    
    function updateBookingsTable() {
        const tableBody = $('#bookingsTableBody');
        tableBody.empty();
        
        bookings.forEach(booking => {
            const statusClass = booking.status === 'Completed' ? 'bg-success' : 'bg-primary';
            tableBody.append(`
                <tr>
                    <td>${booking.service}</td>
                    <td>${booking.date}</td>
                    <td>${booking.period}</td>
                    <td>$${booking.amount.toFixed(2)}</td>
                    <td><span class="badge ${statusClass}">${booking.status}</span></td>
                </tr>
            `);
        });
    }
</script>

</body>
</html>